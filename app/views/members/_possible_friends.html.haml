%section.page-section#friends
  %h2
    - if all_friends
      All
    Possible Friends

  %p
    Shows which people voted most similarly to
    = person.name
    in Parliament.

    This is measured from 0% agreement (never voted the
    same) to 100% (always voted the same). Only votes that both
    attended are counted. This may reveal relationships between
    people that were previously unsuspected. Or it may be nonsense.

  %table.table
    %thead
      %tr.headings
        %th Agreement
        %th Name
    %tbody
      - if person.possible_friends.empty?
        %tr
          %td{colspan: "4"} No results found
      - else
        - possible_friends = person.possible_friends.includes(person2: :members).sort_by{|pd| [pd.distance_b, pd.person2.currently_in_parliament? ? 0 : 1, pd.person2.last_name, pd.person2.first_name]}
        - possible_friends = possible_friends[0..4] if !all_friends
        - possible_friends.each do |person_distance|
          %tr
            %td= fraction_to_percentage_display(person_distance.agreement_fraction_without_absences)
            - if Flipper.enabled?(:link_to_people_compare, current_user)
              %td= link_to person_distance.person2.name, compare_member_path_simple(person.latest_member, person_distance.person2.latest_member)
            - else
              %td= link_to person_distance.person2.name, member_path_simple(person_distance.person2.latest_member)
            %td= member_type_party_place_sentence(person_distance.person2.latest_member)
  - unless all_friends
    = link_to "More possible friends", friends_member_path_simple(person.latest_member), class: 'btn btn-default btn-sm'
  - if person.best_friends.count >= 5 && !all_friends
    (#{pluralize(person.best_friends.count, "other person")} voted exactly the same as this one)
